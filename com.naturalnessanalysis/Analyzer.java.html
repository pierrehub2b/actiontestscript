<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Analyzer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ats-automated-testing</a> &gt; <a href="index.source.html" class="el_package">com.naturalnessanalysis</a> &gt; <span class="el_source">Analyzer.java</span></div><h1>Analyzer.java</h1><pre class="source lang-java linenums">/*
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
&quot;License&quot;); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
&quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
 */

package com.naturalnessanalysis;

import com.naturalness.Event;
import com.naturalness.NaturalnessModel;
import com.naturalness.Sequence;
import com.naturalness.SequenceSuite;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;
import org.xml.sax.SAXException;

import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

public class Analyzer {
    private Map&lt;Sequence&lt;String&gt;, String&gt; testSequenceMap;
    private int depth;
    private double probaOfUnknown;
<span class="nc" id="L44">    final DocumentBuilderFactory dbFactory = DocumentBuilderFactory.newInstance();</span>

<span class="nc" id="L46">    public Analyzer(int depth, double probaOfUnknown) {</span>
<span class="nc" id="L47">        depth = depth;</span>
<span class="nc" id="L48">        probaOfUnknown = probaOfUnknown;</span>
<span class="nc" id="L49">        testSequenceMap = new HashMap&lt;&gt;();</span>
<span class="nc" id="L50">    }</span>

    public void recordSequenceFromLogFile(File logFile ) throws ParserConfigurationException, SAXException, IOException {
<span class="nc" id="L53">        final Document doc = dbFactory.newDocumentBuilder().parse(logFile);</span>
<span class="nc" id="L54">        final Sequence&lt;String&gt; sequence = new Sequence();</span>
<span class="nc" id="L55">        final String ACTION_TAG_NAME = &quot;action&quot;;</span>
<span class="nc" id="L56">        NodeList actionElementList = doc.getElementsByTagName(ACTION_TAG_NAME);</span>
<span class="nc bnc" id="L57" title="All 2 branches missed.">        for (int i=0 ; i &lt; actionElementList.getLength() ; i++) {</span>
<span class="nc" id="L58">            Node actionNode = actionElementList.item(i);</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">            if (actionNode.getNodeType() == Node.ELEMENT_NODE) {</span>
<span class="nc" id="L60">                Element actionElement = (Element) actionNode;</span>
<span class="nc" id="L61">                String hash = hashActionElement(actionElement);</span>
<span class="nc" id="L62">                sequence.append(new Event&lt;String&gt;(hash));</span>
            }
        }
<span class="nc" id="L65">        String name = logFile.getParentFile().getName().replaceAll(&quot;\\_xml$&quot;, &quot;&quot;);</span>
<span class="nc" id="L66">        testSequenceMap.put(sequence, name);</span>
<span class="nc" id="L67">    }</span>

    public String getSequenceName(Sequence&lt;String&gt; sequence) {
<span class="nc" id="L70">        return testSequenceMap.get(sequence);</span>
    }

    public RankAnalysisResult rankAnalysis() {
<span class="nc" id="L74">        SequenceSuite&lt;String&gt; sequenceList = new SequenceSuite(new ArrayList&lt;&gt;(testSequenceMap.keySet()));</span>
<span class="nc" id="L75">        return new RankAnalysisResult(sequenceList.rank(), testSequenceMap);</span>
    }

    public SequenceAnalysis sequenceAnalysis() {
<span class="nc" id="L79">        Map&lt;Sequence&lt;String&gt;, NaturalnessModel&lt;String&gt;&gt; modelMap = new HashMap&lt;&gt;();</span>

<span class="nc bnc" id="L81" title="All 2 branches missed.">        for (Sequence&lt;String&gt; sequence : testSequenceMap.keySet()) {</span>
<span class="nc" id="L82">            NaturalnessModel&lt;String&gt; model = new NaturalnessModel&lt;&gt;(depth, probaOfUnknown);</span>
<span class="nc" id="L83">            model.learn(sequence);</span>
<span class="nc" id="L84">            modelMap.put(sequence, model);</span>
<span class="nc" id="L85">        }</span>

<span class="nc" id="L87">        return new SequenceAnalysis(modelMap, testSequenceMap);</span>
    }

    public GlobalAnalysisResult globalAnalysis() {
<span class="nc" id="L91">        NaturalnessModel&lt;String&gt; model = new NaturalnessModel&lt;&gt;(depth, probaOfUnknown);</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">        for (Sequence&lt;String&gt; sequence : testSequenceMap.keySet()) {</span>
<span class="nc" id="L93">            model.learn(sequence);</span>
<span class="nc" id="L94">        }</span>
<span class="nc" id="L95">        return new GlobalAnalysisResult(model);</span>
    }

    private String hashActionElement(Element actionElement) {
<span class="nc" id="L99">        final String TYPE_ATTRIBUTE = &quot;type&quot;;</span>
<span class="nc" id="L100">        String type = actionElement.getAttribute(TYPE_ATTRIBUTE);</span>

<span class="nc" id="L102">        final String VALUE_TAG_NAME = &quot;value&quot;;</span>
<span class="nc" id="L103">        String value = &quot;&quot;;</span>
<span class="nc" id="L104">        NodeList valueNodeList = actionElement.getElementsByTagName(VALUE_TAG_NAME);</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">        if (valueNodeList.getLength() &gt; 0 ) {</span>
<span class="nc" id="L106">            Node firstValue = valueNodeList.item(0);</span>
<span class="nc" id="L107">            value = firstValue.getTextContent();</span>
        }

<span class="nc" id="L110">        final String CHANNEL_TAG_NAME = &quot;channel&quot;;</span>
<span class="nc" id="L111">        String channel = &quot;&quot;;</span>
<span class="nc" id="L112">        NodeList channelNodeList = actionElement.getElementsByTagName(CHANNEL_TAG_NAME);</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">        if (channelNodeList.getLength() &gt; 0 ) {</span>
<span class="nc" id="L114">            Node firstChannel = channelNodeList.item(0);</span>
<span class="nc" id="L115">            final String CHANNEL_NAME_ATTRIBUTE = &quot;name&quot;;</span>
<span class="nc" id="L116">            channel = ((Element)firstChannel).getAttribute(CHANNEL_NAME_ATTRIBUTE);</span>
        }

<span class="nc" id="L119">        final String ELEMENT_TAG_NAME = &quot;element&quot;;</span>
<span class="nc" id="L120">        String element = &quot;&quot;;</span>
<span class="nc" id="L121">        NodeList elementNodeList = actionElement.getElementsByTagName(ELEMENT_TAG_NAME);</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">        if (elementNodeList.getLength() &gt; 0 ) {</span>
<span class="nc" id="L123">            Node firstElement = elementNodeList.item(0);</span>
<span class="nc" id="L124">            final String ELEMENT_TAG_ATTRIBUTE = &quot;tag&quot;;</span>
<span class="nc" id="L125">            element = ((Element)firstElement).getAttribute(ELEMENT_TAG_ATTRIBUTE);</span>
        }

<span class="nc" id="L128">        final String CRITERIAS_TAG_NAME = &quot;criterias&quot;;</span>
<span class="nc" id="L129">        String criterias = &quot;&quot;;</span>
<span class="nc" id="L130">        NodeList criteriasNodeList = actionElement.getElementsByTagName(CRITERIAS_TAG_NAME);</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">        if (criteriasNodeList.getLength() &gt; 0 ) {</span>
<span class="nc" id="L132">            Node firstCriterias = valueNodeList.item(0);</span>
<span class="nc" id="L133">            criterias = firstCriterias.getTextContent();</span>
        }

<span class="nc" id="L136">        return type + value + channel + element + criterias;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>