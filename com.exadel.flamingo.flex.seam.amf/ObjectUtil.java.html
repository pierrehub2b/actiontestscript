<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ObjectUtil.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ats-automated-testing</a> &gt; <a href="index.source.html" class="el_package">com.exadel.flamingo.flex.seam.amf</a> &gt; <span class="el_source">ObjectUtil.java</span></div><h1>ObjectUtil.java</h1><pre class="source lang-java linenums">/*
  Exadel Flamingo
  Copyright (C) 2008 Exadel, Inc.

  Exadel Flamingo is free software; you can redistribute it and/or modify
  it under the terms of the GNU Lesser General Public License as published by
  the Free Software Foundation

  ObjectUtil.java
  Last modified by: $Author$
  $Revision$   $Date$
*/

package com.exadel.flamingo.flex.seam.amf;

import com.exadel.flamingo.flex.messaging.util.ClassUtil;
import com.exadel.flamingo.flex.messaging.util.StringUtil;

import java.lang.reflect.Method;
import java.lang.reflect.ParameterizedType;
import java.lang.reflect.Type;
import java.math.BigDecimal;
import java.math.BigInteger;
import java.util.List;

<span class="nc" id="L26">public class ObjectUtil {</span>

    public static Method findServiceMethod(final Class objectClass, final String methodName, final Object[] params)
        throws NoSuchMethodException {

<span class="nc" id="L31">        Method serviceMethod = null;</span>
<span class="nc bnc" id="L32" title="All 4 branches missed.">        if (params == null || params.length == 0)</span>
<span class="nc" id="L33">            serviceMethod = objectClass.getMethod(methodName, (Class[]) null);</span>
        else {
<span class="nc bnc" id="L35" title="All 2 branches missed.">            for (Method method : objectClass.getMethods()) {</span>

<span class="nc bnc" id="L37" title="All 2 branches missed.">                if (!methodName.equals(method.getName()))</span>
<span class="nc" id="L38">                    continue;</span>

<span class="nc" id="L40">                Type[] paramTypes = method.getGenericParameterTypes();</span>
<span class="nc bnc" id="L41" title="All 2 branches missed.">                if (paramTypes.length != params.length)</span>
<span class="nc" id="L42">                    continue;</span>

<span class="nc bnc" id="L44" title="All 2 branches missed.">                if (canConvertForMethodInvocation(params, paramTypes)) {</span>
<span class="nc" id="L45">                    serviceMethod = method;</span>
<span class="nc" id="L46">                    break;</span>
                }
            }
        }

<span class="nc bnc" id="L51" title="All 2 branches missed.">        if (serviceMethod == null)</span>
<span class="nc" id="L52">            throw new NoSuchMethodException(objectClass.getName() + '.' + methodName + StringUtil.toString(params));</span>

<span class="nc" id="L54">        return serviceMethod;</span>
    }

    protected static boolean canConvertForMethodInvocation(Object[] values, Type[] targetTypes) {
<span class="nc" id="L58">        boolean canConvert = true;</span>
<span class="nc bnc" id="L59" title="All 4 branches missed.">        for (int i = 0; i &lt; targetTypes.length &amp;&amp; canConvert; i++)</span>
<span class="nc" id="L60">            canConvert = canConvertForMethodInvocation(values[i], targetTypes[i]);</span>
<span class="nc" id="L61">        return canConvert;</span>
    }

    protected static boolean canConvertForMethodInvocation(Object value, Type targetType) {
<span class="nc bnc" id="L65" title="All 2 branches missed.">        if (value == null)</span>
<span class="nc" id="L66">            return true;</span>

<span class="nc" id="L68">        Class&lt;?&gt; valueClass = value.getClass();</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">        if (valueClass == targetType)</span>
<span class="nc" id="L70">            return true;</span>

<span class="nc" id="L72">        Class&lt;?&gt; targetClass = ClassUtil.classOfType(targetType);</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">        if (targetClass.isAssignableFrom(valueClass))</span>
<span class="nc" id="L74">            return true;</span>

        // Class/Primitive Identity &amp; Widening Primitive Conversion.
<span class="nc bnc" id="L77" title="All 2 branches missed.">        if (targetClass.isPrimitive()) {</span>
<span class="nc bnc" id="L78" title="All 66 branches missed.">            if (</span>
                (valueClass == Integer.class &amp;&amp; (
                    targetClass == Integer.TYPE || targetClass == Long.TYPE ||
                        targetClass == Float.TYPE || targetClass == Double.TYPE)) ||
                    (valueClass == Boolean.class &amp;&amp; targetClass == Boolean.TYPE) ||
                    (valueClass == Long.class &amp;&amp; (
                        targetClass == Long.TYPE || targetClass == Float.TYPE || targetClass == Double.TYPE)) ||
                    (valueClass == Float.class &amp;&amp; (targetClass == Float.TYPE || targetClass == Double.TYPE)) ||
                    (valueClass == Byte.class &amp;&amp; (
                        targetClass == Byte.TYPE || targetClass == Short.TYPE || targetClass == Integer.TYPE ||
                            targetClass == Long.TYPE || targetClass == Float.TYPE || targetClass == Double.TYPE)) ||
                    (valueClass == Short.class &amp;&amp; (
                        targetClass == Short.TYPE || targetClass == Integer.TYPE || targetClass == Long.TYPE ||
                            targetClass == Float.TYPE || targetClass == Double.TYPE)) ||
                    (valueClass == Character.class &amp;&amp; (
                        targetClass == Character.TYPE || targetClass == Integer.TYPE || targetClass == Long.TYPE ||
                            targetClass == Float.TYPE || targetClass == Double.TYPE))
                )
<span class="nc" id="L96">                return true;</span>
        }
        // Widening Number Conversion.
<span class="nc bnc" id="L99" title="All 2 branches missed.">        else if (Number.class.isAssignableFrom(targetClass)) {</span>
<span class="nc bnc" id="L100" title="All 78 branches missed.">            if (</span>
                (valueClass == Integer.class &amp;&amp; (
                    targetClass == Long.class || targetClass == Float.class || targetClass == Double.class ||
                        targetClass == BigDecimal.class || targetClass == BigInteger.class)) ||
                    (valueClass == Long.class &amp;&amp; (
                        targetClass == Float.class || targetClass == Double.class ||
                            targetClass == BigDecimal.class || targetClass == BigInteger.class)) ||
                    (valueClass == Float.class &amp;&amp; (
                        targetClass == Double.class || targetClass == BigDecimal.class ||
                            targetClass == BigInteger.class)) ||
                    (valueClass == Byte.class &amp;&amp; (
                        targetClass == Short.class || targetClass == Integer.class || targetClass == Long.class ||
                            targetClass == Float.class || targetClass == Double.class ||
                            targetClass == BigDecimal.class || targetClass == BigInteger.class)) ||
                    (valueClass == Short.class &amp;&amp; (
                        targetClass == Integer.class || targetClass == Long.class ||
                            targetClass == Float.class || targetClass == Double.class ||
                            targetClass == BigDecimal.class || targetClass == BigInteger.class)) ||
                    (valueClass == Character.class &amp;&amp; (
                        targetClass == Integer.class || targetClass == Long.class ||
                            targetClass == Float.class || targetClass == Double.class ||
                            targetClass == BigDecimal.class || targetClass == BigInteger.class)) ||
                    (valueClass == Double.class &amp;&amp; targetClass == BigDecimal.class)
                )
<span class="nc" id="L124">                return true;</span>
        }
        // If it's an array, can we find a matching list?
<span class="nc bnc" id="L127" title="All 4 branches missed.">        else if (valueClass.isArray() &amp;&amp; List.class.isAssignableFrom(targetClass)) {</span>
            // List (not parameterized)
<span class="nc bnc" id="L129" title="All 2 branches missed.">            if (targetType instanceof Class&lt;?&gt;)</span>
<span class="nc" id="L130">                return true;</span>
            // List&lt;...&gt; (parameterized)
<span class="nc bnc" id="L132" title="All 2 branches missed.">            if (targetType instanceof ParameterizedType) {</span>
<span class="nc" id="L133">                Type[] lcts = ((ParameterizedType) targetType).getActualTypeArguments();</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">                if (lcts.length == 1) { // Should always be true for a list...</span>
<span class="nc" id="L135">                    Class&lt;?&gt; lct = ClassUtil.classOfType(lcts[0]);</span>
<span class="nc bnc" id="L136" title="All 2 branches missed.">                    if (lct.isAssignableFrom(valueClass.getComponentType()))</span>
<span class="nc" id="L137">                        return true;</span>
                }
            }
        }

<span class="nc" id="L142">        return false;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>